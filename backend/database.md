# Database

## N + 1 문제
서버쪽 데이터베이스 쿼리에서 자주 마주하는 문제로, 정리해보자면 다음과 같다. 
N 개의 객체 리스트와 각 객체에 연결된 자식 객체들을 조회할 때, 한 번의 쿼리만으로 객체 리스트와 자식 정보를 모두 획득할 수 있음에도,
lazy loading이나 자식 객체에 접근하는 방식에 따라 N+1번의 불필요한 쿼리를 할 수 있다는 문제이다 (N+1번인 이유는 먼저 객체 리스트를 조회하면서 
쿼리를 한 번 사용하고 각 객체에 연결된 자식 객체들을 조회하기 위해 N번의 추가 쿼리하기 때문이다).

## HBase
HBase는 억 단위의 row를 가진 대규모 데이터를 다루는데에 최적화된 HDFS(Hadoop Distributed File System)기반 NoSQL 분산 데이터베이스이다.
HBase를 사용하기 좋은 조건은 1) 많은 데이터를 보유하거나/할 예정일 때, 2) 
RDBMS의 기능들 (타입 정의된 컬럼, 트랜잭션, 고급 쿼리 기능)이 필요하지 않을 때,
그리고 3) 5개 이상의 데이터노드를 띄울 수 있는 기기가 있을 때이다.
두번째 조건을 조금 더 설명하자면, 트랜잭션이 지원되지 않기 때문에 다수의 데이터 읽기/쓰기를 할 때 실패에 유의해 코드를 작성해야 하고, 
쿼리 기능이 약하므로 (서비스를 운영하다보면 자주 하는) 데이터 분석이 불편해진다는 점이 있다.

HBase의 기능을 살펴보자면,

- 일관된 (Strongly consistent) 읽기/쓰기: 최근 업데이트가 반영되지 않은 응답 값이 있을 수 있는 eventually consistent가 아닌,
모든 응답 값이 이전의 쓰기 작업이 반영되어 반환된다.

- Java 친화적: 데이터 접근을 위한 자바 API를 제공한다. 자바 외 다른 언어를 위해선 Thrift/REST API를 제공한다.

- 병렬 프로세싱: 대규모 데이터를 처리하는데에 MapReduce 통한 병렬 프로세싱을 지원한다.

- 장애 극복: 분산 데이터베이스 답게 데이터를 여러 노드에 중복 저장해두어 하나의 노드에서 장애가 일어나도 다른 노드로부터 데이터를 가져올 수 있다.
하지만 현업에서 사용해본 경험을 들었을 때, 생각보다 데이터베이스가 자주 죽어 수시로 살려줬어야 했다고 한다.

- 자동 샤딩: 샤딩이란 테이블의 로우를 분리해서 저장하는 것을 말한다. HBase는 데이터 크기가 커지면 자동으로 region을 분리하고 데이터를 재분배시킨다. 

- 빠른 읽기: 대규모 데이터를 처리함에도 block cache와 bloom filter를 이용해 데이터를 빠르게 스캔할 수 있다. 

- 관리 페이지 제공: 데이터베이스를 운영하고 분석하는 데에 필요한 관리 웹페이지를 제공한다.

### 참고
- [Architecture Overview - Apache HBase](https://hbase.apache.org/book.html#arch.overview)
- [HBase 개념 정리](https://cyberx.tistory.com/164)
